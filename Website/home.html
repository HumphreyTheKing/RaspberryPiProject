import React, { useEffect, useState } from 'react';
import { Loader } from 'lucide-react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

const ParkingApp = () => {
  const [map, setMap] = useState(null);
  const [loading, setLoading] = useState(true);
  const apiKey = "AIzaSyB5GVqZRteRz2N6TwIZ20H3emFxHAOcRaw";

  const garages = [
    {
      title: "Cottage Grove Parking Garage",
      address: "1067 Cottage Grove Ave, Las Vegas, NV 89119",
      status: "High Traffic",
      spots: 540,
      position: { lat: 36.1112, lng: -115.1401 }
    },
    {
      title: "Tropicana Parking Garage",
      address: "12 Wilbur St, Las Vegas, NV 89119",
      status: "High Traffic",
      spots: 960,
      position: { lat: 36.103, lng: -115.1431 }
    },
    {
      title: "University Gateway Parking Garage",
      address: "1280 Dorothy Ave, Las Vegas, NV 89119",
      status: "Low Traffic",
      spots: 1023,
      position: { lat: 36.10342, lng: -115.136193 }
    }
  ];

  useEffect(() => {
    const loadMap = async () => {
      const { Map } = await window.google.maps.importLibrary("maps");
      const { AdvancedMarkerElement } = await window.google.maps.importLibrary("marker");
      
      const position = { lat: 36.1077863, lng: -115.1453609 };
      
      const newMap = new Map(document.getElementById("map"), {
        zoom: 15.7,
        center: position,
        mapId: 'deb598f8aa025a7f',
      });

      garages.forEach(garage => {
        new AdvancedMarkerElement({
          position: garage.position,
          map: newMap,
          title: garage.title
        });
      });

      setMap(newMap);
      setLoading(false);
    };

    const script = document.createElement("script");
    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=maps,marker&v=beta`;
    script.async = true;
    script.defer = true;
    script.onload = loadMap;
    document.head.appendChild(script);

    return () => {
      document.head.removeChild(script);
    };
  }, []);

  const GarageCard = ({ garage }) => (
    <Card className="mb-4 hover:bg-gray-50 cursor-pointer">
      <CardHeader className="pb-2">
        <CardTitle className="text-center">{garage.title}</CardTitle>
      </CardHeader>
      <CardContent className="text-center">
        <p className="italic mb-4">{garage.address}</p>
        <p className="mb-2">Status: {garage.status}</p>
        <p>Parking Spots Remaining: {garage.spots}</p>
      </CardContent>
    </Card>
  );

  return (
    <div className="h-screen flex flex-col">
      <header className="bg-red-700/90 h-[50px]">
        <div className="container h-full ml-[10%]">
          <a href="#" className="h-full w-[100px] text-gray-100 flex items-center justify-center hover:bg-red-800">
            Parkify
          </a>
        </div>
      </header>

      <div className="flex flex-1 lg:flex-row flex-col">
        <div className="lg:w-2/3 p-4 h-[500px] lg:h-auto">
          {loading ? (
            <div className="h-full flex items-center justify-center">
              <Loader className="animate-spin" />
            </div>
          ) : (
            <div id="map" className="h-full rounded-lg shadow-md" />
          )}
        </div>
        
        <div className="lg:w-1/3 p-4 overflow-y-auto">
          <div className="space-y-4">
            {garages.map((garage, index) => (
              <GarageCard key={index} garage={garage} />
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default ParkingApp;
